Métrica	Propósito
Total de Participantes	Quantos colaboradores estão no ciclo.
Autoavaliações Concluídas	Progresso da primeira etapa.
Avaliações do Gestor Concluídas	Progresso da segunda etapa.

SELECT
    c.nome AS ciclo_nome,
    COUNT(DISTINCT cc.colaborador_id) AS total_participantes,
    COUNT(DISTINCT CASE WHEN a_auto.status = 'CONCLUIDA' THEN cc.colaborador_id END) AS autoavaliacoes_concluidas,
    COUNT(DISTINCT CASE WHEN a_gestor.status = 'CONCLUIDA' THEN cc.colaborador_id END) AS avaliacoes_gestor_concluidas,
    (COUNT(DISTINCT CASE WHEN a_gestor.status = 'CONCLUIDA' THEN cc.colaborador_id END) * 100.0 / COUNT(DISTINCT cc.colaborador_id))::numeric(5,2) AS percentual_conclusao_gestor
FROM
    public.ciclo_desempenho c
JOIN
    public.ciclo_colaborador cc ON c.id = cc.ciclo_id
LEFT JOIN
    public.avaliacao a_auto ON cc.id = a_auto.ciclo_colaborador_id AND a_auto.tipo = 'AUTOAVALIACAO'
LEFT JOIN
    public.avaliacao a_gestor ON cc.id = a_gestor.ciclo_colaborador_id AND a_gestor.tipo = 'GESTOR'
WHERE
    c.nome = 'Ciclo Anual 2025' -- Substitua pelo ciclo desejado
GROUP BY
    c.nome;

Painel de Resultados (Matriz 9-Box Agregada)

SELECT
    nb.posicao_x_potencial,
    nb.posicao_y_desempenho,
    COUNT(cc.colaborador_id) AS contagem_colaboradores
FROM
    public.nine_box nb
JOIN
    public.ciclo_colaborador cc ON nb.ciclo_colaborador_id = cc.id
JOIN
    public.ciclo_desempenho c ON cc.ciclo_id = c.id
WHERE
    c.nome = 'Ciclo Anual 2025' -- Filtra pelo ciclo concluído
GROUP BY
    nb.posicao_x_potencial, nb.posicao_y_desempenho
ORDER BY
    nb.posicao_x_potencial, nb.posicao_y_desempenho;

Painel de Detalhes de Pontuação (Média por Competência)
SELECT
    CASE 
        WHEN p.competencia_id IS NOT NULL THEN comp.nome 
        WHEN p.meta_id IS NOT NULL THEN m.titulo 
        ELSE 'N/A' 
    END AS item_avaliacao,
    AVG(p.nota * p.peso_aplicado) AS nota_media_ponderada,
    COUNT(p.id) AS total_avaliacoes_item
FROM
    public.pontuacao p
JOIN
    public.avaliacao a ON p.avaliacao_id = a.id
JOIN
    public.ciclo_colaborador cc ON a.ciclo_colaborador_id = cc.id
JOIN
    public.ciclo_desempenho cd ON cc.ciclo_id = cd.id
LEFT JOIN
    public.competencia comp ON p.competencia_id = comp.id
LEFT JOIN
    public.meta m ON p.meta_id = m.id
WHERE
    cd.nome = 'Ciclo Anual 2025' -- Filtra o ciclo
    AND a.tipo = 'GESTOR'         -- Apenas avaliações do Gestor
GROUP BY
    item_avaliacao
ORDER BY
    nota_media_ponderada DESC;

Histórico de Desempenho do Colaborador
SELECT
    c.nome AS nome_ciclo,
    cc.status_experiencia AS status_ciclo,
    nb.posicao_y_desempenho || ' x ' || nb.posicao_x_potencial AS nine_box_resultado,
    nb.score_final_merito AS score_final,
    nb.elegivel_carreira AS elegivel_carreira,
    nb.data_calculo
FROM
    public.colaborador colab
JOIN
    public.ciclo_colaborador cc ON colab.id = cc.colaborador_id
JOIN
    public.ciclo_desempenho c ON cc.ciclo_id = c.id
LEFT JOIN
    public.nine_box nb ON cc.id = nb.ciclo_colaborador_id
WHERE
    colab.matricula = 'MAT002' -- Substitua pela matrícula do colaborador (Ex: Bruce Wayne)
ORDER BY
    c.data_fim DESC;

Painel de Gestores (Equipe e Status)
SELECT
    colab_equipe.nome AS nome_colaborador,
    colab_equipe.matricula,
    cargo.titulo AS cargo,
    cc.status_experiencia AS status_no_ciclo,
    a_auto.status AS status_autoavaliacao,
    a_gestor.status AS status_avaliacao_gestor
FROM
    public.colaborador colab_gestor
JOIN
    public.colaborador colab_equipe ON colab_gestor.id = colab_equipe.gestor_id
JOIN
    public.cargo ON colab_equipe.cargo_id = cargo.id
LEFT JOIN
    public.ciclo_colaborador cc ON colab_equipe.id = cc.colaborador_id
LEFT JOIN
    public.ciclo_desempenho cd ON cc.ciclo_id = cd.id
LEFT JOIN
    public.avaliacao a_auto ON cc.id = a_auto.ciclo_colaborador_id AND a_auto.tipo = 'AUTOAVALIACAO'
LEFT JOIN
    public.avaliacao a_gestor ON cc.id = a_gestor.ciclo_colaborador_id AND a_gestor.tipo = 'GESTOR'
WHERE
    colab_gestor.matricula = 'MAT001' -- Filtra pelo gestor (Ex: Ana Gomes)
    AND cd.nome = 'Ciclo Anual 2025'
ORDER BY
    colab_equipe.nome;
